<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="mypage">

	<!-- 1. 아이디 찾기 -->
	<select id="findId" resultType="MemberModel">
		SELECT * FROM MEMBER
		WHERE MEMBER_NAME = #{member_name}
		AND MEMBER_JUMIN1 = #{member_jumin1}
		AND MEMBER_JUMIN2 = #{member_jumin2}
	</select>
	
	<!-- 2. 비밀번호 찾기 -->
	<select id="findPw" resultType="MemberModel">
		SELECT MEMBER_PW FROM MEMBER
		WHERE MEMBER_ID = #{member_id}
		AND MEMBER_EMAIL = #{member_email}
	</select>
	
	<!-- 3. 회원 탈퇴 -->
	<delete id="memberOut">
		DELETE FROM MEMBER
		WHERE MEMBER_ID = #{member_id}
	</delete>
	
	<!-- 4. 회원정보 수정 -->
	<update id="memberModify">
		UPDATE MEMBER
		SET MEMBER_PW = #{member_pw}, MEMBER_NAME = #{member_name},
		    MEMBER_JUMIN1 = #{member_jumin1}, MEMBER_JUMIN2 = #{member_jumin2},
		    MEMBER_ZIPCODE = #{member_zipcode}, MEMBER_ADDR1 = #{member_addr1},
		    MEMBER_ADDR2 = #{member_addr2}, MEMBER_MOBILE = #{member_mobile},
		    MEMBER_PHONE = #{member_phone}, MEMBER_EMAIL = #{member_email},
		    MEMBER_EMAIL_GET = #{member_email_get}
		    <!-- <isNotNull property="member_email_get">MEMBER_EMAIL_GET = #{member_email_get}</isNotNull>
		    <isNull property="member_email_get">MEMBER_EMAIL_GET = 'NO'</isNull> -->
		WHERE MEMBER_ID = #{member_id}
	</update>
	
	<!-- 5. 주문상세내역 보기 -->
	<select id="memberOrderDetail" resultType="OrderDetailModel">
		SELECT go.*, me.member_phone, me.member_email, tb.goods_image, tb.goods_num, od.*
		FROM GOODS_ORDER go JOIN MEMBER me ON
		go.member_id = me.member_id JOIN order_detail od ON 
		od.order_trade_num = go.order_trade_num JOIN textbook tb ON
		tb.goods_num = od.goods_num WHERE go.order_trade_num = #{order_trade_num}
	</select>
</mapper>